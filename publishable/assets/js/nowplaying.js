import{u as d}from"./plex.js";const e=d();function l(o){switch(o){case"playing":console.log("-- STARTED NOW PLAYING"),e.setNowPlaying(!0);break;case"paused":case"stopped":console.log("-- STOPPED NOW PLAYING"),e.setNowPlaying(!1);break}}function g(){const o=new WebSocket("ws://"+e.settings.plexIpAddress+":32400/:/websockets/notifications?X-Plex-Token="+e.settings.plexToken);o.addEventListener("open",()=>{}),o.addEventListener("message",c=>{const n=JSON.parse(c.data),a=n.NotificationContainer.type;let t;if(console.log("PLEX ACTION: ",a),a==="playing"&&(t=n.NotificationContainer.PlaySessionStateNotification[0].state,console.log("PLEX STATE: ",t),!this.checkedPlexMediaType)){console.log("PLEX CHECK SESSION TYPE");const p=(e.settings.plexUseSsl?"https":"http")+"://"+e.settings.plexIpAddress+":32400";route+="?X-Plex-Token="+e.settings.plexToken,axios.get(p+route+"/status/sessions/").then(s=>{if(console.log(s),s.data.MediaContainer.size>0){let i=s.data.MediaContainer.Metadata[0];this.checkedPlexMediaType=!0,(i.type==="movie"&&e.settings.plexShowMovieNowPlaying||(i.type==="show"||i.type==="episode")&&e.settings.plexShowTvNowPlaying)&&l(t)}}).catch(()=>{})}t==="stopped"&&e.nowPlaying&&(this.checkedPlexMediaType=!1,l(t))})}setTimeout(()=>{e.getPlexSettings().then(()=>{g()})},5e3);
