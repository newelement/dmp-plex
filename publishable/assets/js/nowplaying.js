import{u as d}from"./plex.js";const e=d();function l(s){switch(s){case"playing":console.log("-- STARTED NOW PLAYING"),e.setNowPlaying(!0);break;case"paused":case"stopped":console.log("-- STOPPED NOW PLAYING"),e.setNowPlaying(!1);break}}function g(){const s=new WebSocket("ws://"+e.settings.plex_ip_address+":32400/:/websockets/notifications?X-Plex-Token="+e.settings.plex_token);s.addEventListener("open",()=>{}),s.addEventListener("message",c=>{const n=JSON.parse(c.data),a=n.NotificationContainer.type;let t;if(console.log("PLEX ACTION: ",a),a==="playing"&&(t=n.NotificationContainer.PlaySessionStateNotification[0].state,console.log("PLEX STATE: ",t),!this.checkedPlexMediaType)){console.log("PLEX CHECK SESSION TYPE");const p=(e.settings.plex_use_ssl?"https":"http")+"://"+e.settings.plex_ip_address+":32400";route+="?X-Plex-Token="+e.settings.plex_token,axios.get(p+route+"/status/sessions/").then(o=>{if(console.log(o),o.data.MediaContainer.size>0){let i=o.data.MediaContainer.Metadata[0];this.checkedPlexMediaType=!0,(i.type==="movie"&&e.settings.plex_show_movie_now_playing||(i.type==="show"||i.type==="episode")&&e.settings.plex_show_tv_now_playing)&&l(t)}}).catch(()=>{})}t==="stopped"&&e.nowPlaying&&(this.checkedPlexMediaType=!1,l(t))})}setTimeout(()=>{e.getPlexSettings().then(()=>{g()})},5e3);
